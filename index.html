<!DOCTYPE html>

<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Онлайн-табло — Аэропорт</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Open Sans -->

  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;1,400&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Open Sans', system-ui, -apple-system, sans-serif;
      color: #1f2937;
      background: #ffffff;
    }

    .container { max-width: 1200px; margin: 0 auto; padding: 32px 24px; }

    h1 { font-size: 48px; font-weight: 400; margin: 0 0 32px; }

    .tabs {
      display: flex;
      gap: 24px;
      margin-bottom: 24px;
      font-size: 20px;
    }

    .tab.active {
      border-bottom: 3px solid #22c55e;
      padding-bottom: 6px;
    }

    .filters {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 16px;
    }

    .filters input {
      padding: 14px 16px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      min-width: 260px;
    }

    .search-btn {
      padding: 14px 24px;
      border-radius: 999px;
      border: none;
      background: #22c55e;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }

    .archive-toggle {
      color: #22c55e;
      cursor: pointer;
      margin-bottom: 12px;
      display: inline-block;
    }

    .table-head, .flight {
      display: grid;
      grid-template-columns: 120px 1.5fr 1fr 1.5fr 1fr 1.5fr;
      align-items: center;
      padding: 18px 0;
    }

    .table-head {
      background: #e9f8ee;
      border-radius: 999px;
      padding: 18px 24px;
      font-weight: 400;
    }

    .flight {
      padding: 24px 24px;
      border-bottom: 1px solid #e5e7eb;
    }

    .time old { text-decoration: line-through; color: #9ca3af; margin-left: 8px; }

    .city { font-size: 20px; }

    .status {
      background: #f3f4f6;
      border-radius: 999px;
      padding: 8px 16px;
      display: inline-block;
      font-size: 14px;
    }

    .empty {
      padding: 48px;
      text-align: center;
      color: #6b7280;
    }

    @media (max-width: 900px) {
      .table-head, .flight {
        grid-template-columns: 1fr;
        gap: 8px;
      }
    }
  
    /* MODAL */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal {
      background: #fff;
      border-radius: 16px;
      max-width: 520px;
      width: 100%;
      padding: 24px;
      box-shadow: 0 20px 40px rgba(0,0,0,.2);
    }
    .modal h2 { margin: 0 0 16px; font-weight: 400; }
    .modal-row { margin-bottom: 10px; }
    .modal-close {
      margin-top: 20px;
      background: #22c55e;
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      cursor: pointer;
    }
  </style>

</head>
<body>

<!-- TOP BAR -->

<div style="border-bottom:1px solid #e5e7eb;font-size:14px;">
  <div class="container" style="display:flex;justify-content:space-between;align-items:center;">
    <div>САРАТОВ</div>
    <div id="datetime">—</div>
    <div id="weather">—</div>
  </div>
</div>

<div class="container">
  <h1>Онлайн-табло</h1>

  <div class="tabs">
    <div class="tab active">Вылет</div>
    <div class="tab" style="opacity:.3">Прилёт</div>
  </div>

  <div class="filters">
    <input placeholder="Сегодня" disabled>
    <input placeholder="Любое время" disabled>
    <input placeholder="Поиск по номеру рейса, городу и авиакомпании">
    <button class="search-btn">Искать</button>
  </div>

  <div class="archive-toggle show-archive">Показать вылетевшие ▾</div>

  <div class="table-head">
    <div>Вылет</div><div>Направление</div><div>Рейс</div><div>Авиакомпания</div><div>Выход</div><div>Статус</div>
  </div>

  <div class="flights"></div>

<!-- MODAL -->

<div class="modal-overlay" id="modal">
  <div class="modal">
    <h2 id="modalTitle"></h2>
    <div class="modal-row" id="modalBody"></div>
    <button class="modal-close" onclick="closeModal()">Закрыть</button>
  </div>
</div>
</div>

<script>
  let showArchive = false;

  const flights = [
    {
      time: '17:30',
      city: 'Москва / ШРМ',
      flight: 'SU-1209',
      airline: 'Аэрофлот',
      gate: '1, 2 / 1',
      statuses: [
        { from: '16:50', text: 'Регистрация' },
        { from: '17:15', text: 'Посадка' },
        { from: '17:35', text: 'Вылетел' }
      ]
    }
  ];

  function getSaratovTime() {
    return new Date(new Date().toLocaleString('ru-RU', { timeZone: 'Europe/Saratov' }));
  }

  function updateDateTime() {
    const now = getSaratovTime();
    document.getElementById('datetime').textContent =
      now.toLocaleDateString('ru-RU', { day:'numeric', month:'long' }) +
      ', ' + now.toLocaleTimeString('ru-RU', { hour:'2-digit', minute:'2-digit' }) +
      ' (UTC+4)';
  }

  function timeToMinutes(t) {
    const [h, m] = t.split(':').map(Number);
    return h * 60 + m;
  }

  function getStatus(flight, nowMin) {
    let current = null;
    flight.statuses.forEach(s => {
      if (nowMin >= timeToMinutes(s.from)) current = s.text;
    });
    return current || 'Ожидание';
  }

  function createFlightRow(f, status) {
    const row = document.createElement('div');
    row.className = 'flight';
    row.style.cursor = 'pointer';

    row.onclick = () => openModal(f, status);

    row.innerHTML = `
      <div class="time">${f.time}</div>
      <div class="city">${f.city}</div>
      <div>${f.flight}</div>
      <div>${f.airline}</div>
      <div>${f.gate}</div>
      <div><span class="status">${status}</span></div>
    `;
    return row;
  }

  function renderFlights() {
    const container = document.querySelector('.flights');
    container.innerHTML = '';

    const now = getSaratovTime();
    const nowMin = now.getHours() * 60 + now.getMinutes();

    let visible = 0;

    flights.forEach(f => {
      const status = getStatus(f, nowMin);
      const isDeparted = status === 'Вылетел' || status === 'Посадка окончена';
      if (isDeparted && !showArchive) return;
      visible++;
      container.appendChild(createFlightRow(f, status));
    });

    if (visible === 0 && !showArchive) {
      showArchive = true;
      renderFlights();
      return;
    }

    if (visible === 0) {
      container.innerHTML = '<div class="empty">На данный момент вылетов нет</div>';
    }
  }

  document.querySelector('.show-archive').onclick = () => {
    showArchive = !showArchive;
    document.querySelector('.show-archive').textContent = showArchive
      ? 'Скрыть вылетевшие ▴'
      : 'Показать вылетевшие ▾';
    renderFlights();
  };

  async function loadWeather() {
    try {
      const r = await fetch('https://api.open-meteo.com/v1/forecast?latitude=51.53&longitude=46.03&current_weather=true');
      const d = await r.json();
      document.getElementById('weather').textContent = d.current_weather.temperature + '°C';
    } catch {
      document.getElementById('weather').textContent = '—';
    }
  }

  updateDateTime();
  loadWeather();
  renderFlights();
  setInterval(updateDateTime, 60000);
  setInterval(renderFlights, 60000);

  function openModal(f, status) {
    document.getElementById('modalTitle').textContent = f.city;
    document.getElementById('modalBody').innerHTML = `
      <div class="modal-row"><b>Рейс:</b> ${f.flight}</div>
      <div class="modal-row"><b>Авиакомпания:</b> ${f.airline}</div>
      <div class="modal-row"><b>Время вылета:</b> ${f.time}</div>
      <div class="modal-row"><b>Выход:</b> ${f.gate}</div>
      <div class="modal-row"><b>Статус:</b> ${status}</div>
    `;
    document.getElementById('modal').style.display = 'flex';
  }

  function closeModal() {
    document.getElementById('modal').style.display = 'none';
  }
</script>

</body>
</html>

