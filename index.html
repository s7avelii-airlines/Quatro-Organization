<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Онлайн-табло — Аэропорт Ломакино</title>
<style>
body{margin:0;font-family:sans-serif;background:#fff;color:#0f172a;}
h1{font-size:32px;margin:20px 0;}
.tab{cursor:pointer;padding:10px 20px;margin-right:10px;font-weight:bold;}
.tab.active{color:#22c55e;border-bottom:3px solid #22c55e;}
.board{margin-top:20px;}
.row{display:grid;grid-template-columns:120px 1.5fr 1fr 1.5fr 1fr 1.5fr;align-items:center;padding:10px 5px;border-bottom:1px solid #eee;}
.archived{opacity:0.5;}
.status.wait{background:#f1f5f9;padding:4px 8px;border-radius:999px;}
.status.process{background:#fde68a;padding:4px 8px;border-radius:999px;}
.status.done{background:#bbf7d0;padding:4px 8px;border-radius:999px;}
.status.delay{background:#fecaca;padding:4px 8px;border-radius:999px;}
@media(max-width:768px){
  .row{grid-template-columns:1fr;gap:6px;}
  .row div{display:flex;justify-content:space-between;}
  .row div::before{content:attr(data-label);color:#64748b;}
}
</style>
</head>
<body>
<h1>Онлайн-табло</h1>
<div>
  <span class="tab active" data-type="departure">Вылет</span>
  <span class="tab" data-type="arrival">Прилёт</span>
</div>
<button id="toggleArchive">Показать архив ▾</button>
<div class="board" id="board"></div>

<script>
// ===== ВРЕМЯ =====
function nowUTC4(){
  const d=new Date();
  return new Date(d.getTime()+(4-d.getTimezoneOffset()/60)*3600000);
}
function toMin(t){const [h,m]=t.split(':').map(Number);return h*60+m;}

// ===== ДНИ =====
function getScheduleType(){
  const d=nowUTC4().getDay();
  return [1,2,4,5,6].includes(d)?'main':'alt';
}

// ===== РЕЙСЫ (Твой формат) =====
const flightPlans={
  departure:{
    main:[
      {
        time:'07:15',direction:'Пенза',flight:'FV-6499',airline:'Россия',logo:'images/1766062981943.avif',gate:'2',
        statuses:[
          {from:'04:10',text:'Регистрация началась'},
          {from:'04:15',text:'Регистрация'},
          {from:'06:30',text:'Регистрация окончена'},
          {from:'06:35',text:'Посадка началась'},
          {from:'06:40',text:'Посадка'},
          {from:'07:10',text:'Посадка окончена'},
          {from:'07:17',text:'Вылетел'}
        ]
      }
    ],
    alt:[
      {
        time:'09:40',direction:'Сочи',flight:'DP-128',airline:'Победа',logo:'images/1766063004710.avif',gate:'3',
        statuses:[
          {from:'08:40',text:'Регистрация началась'},
          {from:'08:50',text:'Регистрация'},
          {from:'09:20',text:'Посадка'},
          {from:'09:50',text:'Вылетел'}
        ]
      }
    ]
  },
  arrival:{
    main:[
      {
        time:'10:35',direction:'Сочи',flight:'DP-128',airline:'Победа',logo:'images/1766063004710.avif',gate:'3',
        statuses:[
          {from:'10:36',text:'Совершил посадку'},
          {from:'10:40',text:'Прибыл'},
          {from:'10:45',text:'Выдача багажа'},
          {from:'11:00',text:'Выдача завершена'}
        ]
      }
    ],
    alt:[
      {
        time:'11:50',direction:'Москва',flight:'FV-6499',airline:'Россия',logo:'images/1766062981943.avif',gate:'2',
        statuses:[
          {from:'11:55',text:'Прибыл'},
          {from:'12:00',text:'Выдача багажа'},
          {from:'12:20',text:'Выдача завершена'}
        ]
      }
    ]
  }
};

// ===== STATE =====
let boardType='departure';
let showArchive=false;

// ===== СТАТУС =====
function getFlightStatus(flight,nowMin){
  let current='Ожидание',factTime=null,cls='wait';
  flight.statuses.forEach(s=>{
    if(nowMin>=toMin(s.from)){
      current=s.text;
      if(/Вылетел|Прибыл|завершена/i.test(s.text)){
        factTime=s.from; cls='done';
      } else if(/Регистрация|Посадка|багаж/i.test(s.text)){cls='process';}
      else if(/Задерж/i.test(s.text)){cls='delay';}
    }
  });
  return {text:current,factTime,cls};
}

// ===== RENDER =====
function render(){
  const board=document.getElementById('board');
  board.innerHTML='';
  const now=nowUTC4();
  const nowMin=now.getHours()*60+now.getMinutes();
  const schedule=getScheduleType();
  const data=flightPlans[boardType][schedule];

  data.forEach(f=>{
    const s=getFlightStatus(f,nowMin);
    const isArchived=/Вылетел|завершена/i.test(s.text);
    if(isArchived&&!showArchive)return;

    board.innerHTML+=`
      <div class="row ${isArchived?'archived':''}">
        <div data-label="Время">${s.factTime?`<s>${f.time}</s> <b>${s.factTime}</b>`:f.time}</div>
        <div data-label="Направление">${f.direction}</div>
        <div data-label="Рейс">${f.flight}</div>
        <div data-label="Авиакомпания"><img src="${f.logo}" style="height:24px;margin-right:4px;">${f.airline}</div>
        <div data-label="Выход">${f.gate}</div>
        <div data-label="Статус" class="status ${s.cls}">${s.text}</div>
      </div>`;
  });
}

// ===== UI =====
document.querySelectorAll('.tab').forEach(t=>{
  t.onclick=()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    boardType=t.dataset.type;
    showArchive=false;
    render();
  };
});
document.getElementById('toggleArchive').onclick=()=>{
  showArchive=!showArchive;
  render();
};

render();
setInterval(render,30000);
</script>
</body>
</html>

